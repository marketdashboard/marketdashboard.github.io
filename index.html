<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-CMXPPDJB56"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-CMXPPDJB56');
	</script>
	
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Market Dashboard">
	<meta name="author" content="Gokulan Viswanathan">
	<!-- Auto refresh the page for every 90 seconds -->
	<meta http-equiv="refresh" content="90"/>

	<link rel="icon" type="image/jfif" sizes="16x16" href="./images/market-dashboard-title.jfif">

	<title>Market Dashboard</title>

	<!-- Theme CSS -->
	<link href="styles/custom-style.css" rel="stylesheet">

	<!-- Custom Fonts -->
	<link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet'
		type='text/css'>
	<link
		href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
		rel='stylesheet' type='text/css'>
		
	<link rel="stylesheet" href="./script/bootstrap.min.css">
  <script src="./script/jquery.min.js"></script>
  <script src="./script/bootstrap.min.js"></script>

</head>

<body>

	<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container-fluid">
	<center>
    <div class="navbar-header">
      <a class="navbar-brand" href="./index.html">Insights on Indices</a>
    </div>
	</center>
	</nav>
			<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
				<div id="section1" class="container-fluid main-class">
				<h2>Nifty 50 & Sensex</h2>
					<div class="states-box">
						<p id="updatedTime" style="font-size: 11px; padding-left: 5px">Last updated on: </p>
						<blockquote>
							<table class="table table-hover">
								<thead class="covidHeading">
									<tr>
										<th class="table-header-center header-confirmed headerFirst">Index</th>
										<th class="table-header-center header-cprice headerValue">Last Price</th>
										<th class="table-header-center header-dhigh headerValue">Day High</th>
										<th class="table-header-center header-dlow headerValue">Day Low</th>
										<th class="table-header-center header-change headerValue">% Change</th>
									</tr>
								</thead>
								<tbody class="covidValue" id="covidValue">
									<!-- <tr class="covidValue" id="covidValue">
									</tr> -->
								</tbody>
							</table>
						</blockquote>
					</div>
					
					<div class="states-box">
						<h3 class="section-heading" style="padding-left: 5px">NSE Indices</h3>
						<p id="updatedTimeNse" style="font-size: 11px; padding-left: 5px">Last updated on: </p>
						<blockquote>
							<table class="table table-hover">
								<thead class="covidHeading">
									<tr>
										<th class="table-header-center header-confirmed headerFirst">Index</th>
										<th class="table-header-center header-cprice headerValue">Last Price</th>
										<th class="table-header-center header-dhigh headerValue">Day High</th>
										<th class="table-header-center header-dlow headerValue">Day Low</th>
										<th class="table-header-center header-change headerValue">% Change</th>
									</tr>
								</thead>
								<tbody class="nseValue" id="nseValue">
								</tbody>
							</table>
						</blockquote>
					</div>
					
					<div class="states-box-bse">
						<h3 class="section-heading" style="padding-left: 5px">BSE Indices</h3>
						<p id="updatedTimeOthers" style="font-size: 11px; padding-left: 5px">Last updated on: </p>
						<blockquote>
							<table class="table table-hover">
								<thead class="covidHeading">
									<tr>
										<th class="table-header-center header-confirmed headerFirst">Index</th>
										<th class="table-header-center header-cprice headerValue">Last Price</th>
										<th class="table-header-center header-dhigh headerValue">Day High</th>
										<th class="table-header-center header-dlow headerValue">Day Low</th>
										<th class="table-header-center header-change headerValue">% Change</th>
									</tr>
								</thead>
								<tbody class="otherValue" id="otherValue">
									<!-- <tr class="covidValue" id="covidValue">
									</tr> -->
								</tbody>
							</table>
						</blockquote>
					</div>
				</div>
			</div>

	<hr>

	<script>

		function formatDate(date) {
			var utc = date.toUTCString() // 'ddd, DD MMM YYYY HH:mm:ss GMT'
			return utc.slice(8, 12) + utc.slice(5, 7) + ", " + utc.slice(12, 16)
		}

		function comp(a, b) {
			return new Date(b.updated_at).getTime() - new Date(a.updated_at).getTime();
		}
		
		function numberWithCommas(x) {
			return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
		}
		
		function getNiftyIndex() {
			
			$.ajax(
			{
				method: "GET",
				url: "https://priceapi-aws.moneycontrol.com/pricefeed/notapplicable/inidicesindia/in%3BNSX",
				success: function (resData) {
				
					var actualData = resData["data"];
					
					if (actualData["company"] === 'NIFTY 50') {
						updatedTimeTemplate = actualData["lastupd"] + " IST  " + '<img src="./images/live_icon.gif" width="32" height="22" draggable="false"/>';
						$("#updatedTime").append(updatedTimeTemplate);
						//SBI--https://priceapi-aws.moneycontrol.com/pricefeed/bse/equitycash/SBI

						valueTemplate = '<tr><td class="header-confirmed numberFirst">' + numberWithCommas(actualData["company"]).toUpperCase() + '</td>'
							+ '<td class="header-cprice numberValue">' + numberWithCommas(actualData["pricecurrent"]) + '</td>'
							+ '<td class="header-dhigh numberValue">' + numberWithCommas(actualData["HIGH"]) + '</td>'
							+ '<td class="header-dlow numberValue">' + numberWithCommas(actualData["LOW"]) + '</td>'
							+ '<td class="header-change numberValue">' + numberWithCommas(actualData["PERCCHANGE"]) + '%</td></tr>';
						$("#covidValue").append(valueTemplate);
					}
				},
				error: function (xhr, status, error) {
					alert(error);
				}
			});
		}
		
		function getSensexIndex() {
			
			$.ajax(
			{
				method: "GET",
				url: "https://priceapi-aws.moneycontrol.com/pricefeed/notapplicable/inidicesindia/in%3BSEN",
				success: function (resData) {
				
					var actualData = resData["data"];
					
					if (actualData["company"] === 'SENSEX') {
						//SBI--https://priceapi-aws.moneycontrol.com/pricefeed/bse/equitycash/SBI

						valueTemplate = '<tr><td class="header-confirmed numberFirst">' + numberWithCommas(actualData["company"]).toUpperCase() + '</td>'
							+ '<td class="header-cprice numberValue">' + numberWithCommas(actualData["pricecurrent"]) + '</td>'
							+ '<td class="header-dhigh numberValue">' + numberWithCommas(actualData["HIGH"]) + '</td>'
							+ '<td class="header-dlow numberValue">' + numberWithCommas(actualData["LOW"]) + '</td>'
							+ '<td class="header-change numberValue">' + numberWithCommas(actualData["PERCCHANGE"]) + '%</td></tr>';
						$("#covidValue").append(valueTemplate);
					}
				},
				error: function (xhr, status, error) {
					alert(error);
				}
			});
		}
		
		function getNseIndices(indexCode) {
			$.ajax(
				{
					
					method: "GET",
					url: "https://priceapi-aws.moneycontrol.com/pricefeed/notapplicable/inidicesindia/" + indexCode,
					success: function (resData) {
					
					var actualData = resData["data"];
					
					//Populate timestamp only once in iteration
					if (indexCode === "in%3Bccx") {
						updatedTimeTemplateOthers = actualData["lastupd"] + " IST  " + '<img src="./images/live_icon.gif" width="32" height="22" draggable="false"/>';
						$("#updatedTimeNse").append(updatedTimeTemplateOthers);
					}
					
					valueTemplate = '<tr><td class="header-confirmed numberFirst">' + numberWithCommas(actualData["company"]).toUpperCase() + '</td>'
						+ '<td class="header-cprice numberValue">' + numberWithCommas(actualData["pricecurrent"]) + '</td>'
						+ '<td class="header-dhigh numberValue">' + numberWithCommas(actualData["HIGH"]) + '</td>'
						+ '<td class="header-dlow numberValue">' + numberWithCommas(actualData["LOW"]) + '</td>'
						+ '<td class="header-change numberValue">' + numberWithCommas(actualData["PERCCHANGE"]) + '%</td></tr>';
						$("#nseValue").append(valueTemplate);
						sortDataByAscOrder('nseValue');
				},
				error: function (xhr, status, error) {
					alert(error);
				}
			});
		}
		
		function getBseIndices(indexCode) {
			$.ajax(
				{
					
					method: "GET",
					url: "https://priceapi-aws.moneycontrol.com/pricefeed/notapplicable/inidicesindia/" + indexCode,
					success: function (resData) {
					
					var actualData = resData["data"];
					
					//Populate timestamp only once in iteration
					if (indexCode === "in%3BBCX" || indexCode === "in%3Bccx") {
						updatedTimeTemplateOthers = actualData["lastupd"] + " IST  " + '<img src="./images/live_icon.gif" width="32" height="22" draggable="false"/>';
						$("#updatedTimeOthers").append(updatedTimeTemplateOthers);
					}
					
					valueTemplate = '<tr><td class="header-confirmed numberFirst">' + numberWithCommas(actualData["company"]).toUpperCase() + '</td>'
						+ '<td class="header-cprice numberValue">' + numberWithCommas(actualData["pricecurrent"]) + '</td>'
						+ '<td class="header-dhigh numberValue">' + numberWithCommas(actualData["HIGH"]) + '</td>'
						+ '<td class="header-dlow numberValue">' + numberWithCommas(actualData["LOW"]) + '</td>'
						+ '<td class="header-change numberValue">' + numberWithCommas(actualData["PERCCHANGE"]) + '%</td></tr>';
						$("#otherValue").append(valueTemplate);
						sortDataByAscOrder('otherValue');
				},
				error: function (xhr, status, error) {
					alert(error);
				}
			});
		}
		
		// Get Nifty50 Index with updated timestamp
		getNiftyIndex();
		
		// Get Sensex Index
		getSensexIndex();

		// Get other NSE & BSE Indices
		{
			var bseIndices = ["in%3BBCX","in%3Bbmx","in%3Bcey","in%3Bihb","in%3Bblp","IN%3Bbsx","IN%3BNTL","IN%3BSEI","IN%3BBNX","IN%3Bbkx","IN%3Baox","IN%3Bogx","in%3Bbsq","in%3Bspf","IN%3BFMX","IN%3BHAX","in%3Bmfg","IN%3Bifx","in%3Bbpo","in%3Bpbx","in%3Btez"];
			
			var nseIndices = ["in%3Bcjn","in%3Bccx","in%3Bmfy","in%3Bnnx","in%3Bncx","in%3Bcnxa","in%3Bnbx","in%3Bcgy","in%3Bcfm","in%3Bcfr","in%3Bcnit","in%3Bcnmx","in%3BCNXM","in%3Bcxc","in%3Bcpr","in%3Bcps","in%3Bcuk","in%3Bcrv","in%3Bcrl"];
			
			for (var nseElem=0; nseElem <= nseIndices.length-1; nseElem++) {
				getNseIndices(nseIndices[nseElem]);
			}
			
			for (var bseElem=0; bseElem <= bseIndices.length-1; bseElem++) {
				getBseIndices(bseIndices[bseElem]);
			}
			
		}
		
		// Sort data by ascending order
		function sortDataByAscOrder(nodeId) {
			var list = document.getElementById(nodeId);

			var items = list.childNodes;
			var itemsArr = [];
			for (var i in items) {
				if (items[i].nodeType == 1) { // get rid of the whitespace text nodes
					itemsArr.push(items[i]);
				}
			}

			itemsArr.sort(function(a, b) {
			  return a.innerHTML == b.innerHTML
					  ? 0
					  : (a.innerHTML > b.innerHTML ? 1 : -1);
			});

			for (i = 0; i < itemsArr.length; ++i) {
			  list.appendChild(itemsArr[i]);
			}
		}	
		
		
	</script>

	<nav class="navbar navbar-inverse navbar-fixed-bottom">
	<div class="icon-bar">
		<center>
			<a class="active" data-toggle="tooltip" title="MoneyControl" href="https://www.moneycontrol.com/"
								target="_blank" class="Finance"><img href src="images/mc.png" width="42"
									height="36" draggable="false"></a>
		</center>
	</div>
	</nav>
</body>

</html>